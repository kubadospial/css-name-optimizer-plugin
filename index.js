var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var s,i=1,t=arguments.length;i<t;i++)for(var o in s=arguments[i])Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);return e}).apply(this,arguments)};!function(e){if("object"==typeof module&&"object"==typeof module.exports){var s=e(require,exports);void 0!==s&&(module.exports=s)}else"function"==typeof define&&define.amd&&define(["require","exports","./lib/css-mapper","./lib/parsing-processor","./lib/utils"],e)}(function(e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=e("./lib/css-mapper"),p=e("./lib/parsing-processor"),c=e("./lib/utils"),a=e("neo-async"),i=e("fs");function t(e){this.options={sourceMapPath:"./",isSourceMapEnabled:!1,isSourceMapNameVersioned:!1,isVerboseEnabled:!1},this.options=Object.assign(this.options,e),c.setUtilSettings(this.options)}module.exports=(t.prototype.apply=function(e){var t=this;e.hooks.afterCompile.tapAsync("Css-Name-Optimizer",function(e,s){var i=e.assets;t._createCssMap(i),t._processParsing(i),s()}),e.hooks.done.tapAsync("Css-Name-Optimizer",function(e,s){t.options.isSourceMapEnabled&&Object.keys(t.map).length&&(t.filePath=c.createFilePath(),t._saveMapFile(t.filePath,t.map)),s()})},t.prototype._processParsing=function(n){var r=this;a.each(Object.keys(n),function(e,s){if(c.isFileValid(e)){var i=n[e],t=!i.children,o=t?i._value:i.children[0]._value,a=p.parsingProcessor(o,e,r.map);t?i._value=a:i.children[0]._value=a}})},t.prototype._createCssMap=function(i){var t=this;a.each(Object.keys(i),function(e,s){t.map=__assign({},t.map,o.cssMapper(e,i))})},t.prototype._saveMapFile=function(e,s){s&&i.writeFile(e,JSON.stringify(s),function(e){if(e)throw e})},t)});